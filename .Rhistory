"e_muup","e_zetai",
"e_pitarget","e_term")))
dataVardecompo<-rbind(risk_df,techno_df,invest_df,vardecompo)
dataVardecompo<-transform(dataVardecompo,value=round(value*100,0))
levels(dataVardecompo$observ)<-list("gdp"="gdp",
"consumption"="consumption",
"investment"="investment",
"credit"="credit",
"networth"="networth",
"credit spread"="Spread1",
"inflation"="inflation",
"hours worked"="hours",
"wage"="wage",
"interest rate"="Re",
"slope"="Spread1",
"invest. price"="pinvest")
dataVardecompo<-subset(dataVardecompo,!is.na(observ))
levels(dataVardecompo$variable)<-list("risk"="risk",
"equity"="e_gamma",
"investment"="investment",
"technology"="technology",
"markup"="e_lambdaf",
"cons. pref."="e_zetac",
"inflation target"="e_pitarget",
"term structure"="e_term",
"monetary"="e_xp",
"gov. exp."="e_g")
vardecompo<-dcast(dataVardecompo,country + observ ~ variable)
#birf
rownames<-c(row.names(as.data.frame(dataUS[["birf"]][2])))
name<-colsplit(rownames,"\\.",c("variable","obs","shock"))
name[2]<-NULL
meanbirfUS<-data.frame(int="mean",matrix(unlist(dataUS[["birf"]][2]),nrow = 260,byrow = T))
infbirfUS<-data.frame(int="inf",matrix(unlist(dataUS[["birf"]][5]),nrow = 260,byrow = T))
supbirfUS<-data.frame(int="sup",matrix(unlist(dataUS[["birf"]][6]),nrow = 260,byrow = T))
birfUS<-data.frame(country="United States",name,rbind(meanbirfUS,infbirfUS,supbirfUS))
meanbirfEA<-data.frame(int="mean",matrix(unlist(dataEA[["birf"]][2]),nrow = 260,byrow = T))
infbirfEA<-data.frame(int="inf",matrix(unlist(dataEA[["birf"]][5]),nrow = 260,byrow = T))
supbirfEA<-data.frame(int="sup",matrix(unlist(dataEA[["birf"]][6]),nrow = 260,byrow = T))
birfEA<-data.frame(country="Euro Area",name,rbind(meanbirfEA,infbirfEA,supbirfEA))
birf<-rbind(birfUS,birfEA)
birf<-subset(birf,!(variable=="sigma" | shock %in% list("e.xi1","e.xi2","e.xi3","e.xi4",
"e.xi5","e.xi6","e.xi7","e.xi8")
)
)
names(birf)<-c("country","variable","shock","int",1:40)
dataBirf<-melt(birf,id.vars=c("variable","shock","country","int"),variable.name="time")
dataBirf$variable<-factor(dataBirf$variable)
dataBirf$shock<-factor(dataBirf$shock)
levels(dataBirf$variable)<-listObsRaw
levels(dataBirf$shock)<-list("temporary technology"="e.epsil",
"government consumption"="e.g",
"equity"="e.gamma",
"price markup"="e.lambdaf",
"investment price"="e.muup",
"persistent technology growth"="e.muzstar",
"inflation target"="e.pitarget",
"consumption preferences"="e.zetac",
"investment efficiency"="e.zetai",
"risk"="e.sigma",
"term structure"="e.term",
"monetary policy"="e.xp")
birf<-dcast(dataBirf,variable + shock + country + time ~ int)
#counterfact
data<-readMat("C:/Users/brand/Dropbox/cepii_dsge/cmrfiles_deficit/counterfactual_analysis/cmr_output_counterfactual.mat")
usmodel.usshocks<-data.frame(model="United States",shock="United States",variable=obsnames,data[["y.usmodel.usshocks"]][1:12,])
usmodel.eashocks<-data.frame(model="United States",shock="Euro Area",variable=obsnames,data[["y.usmodel.eashocks"]][1:12,])
eamodel.eashocks<-data.frame(model="Euro Area",shock="Euro Area",variable=obsnames,data[["y.eamodel.eashocks"]][1:12,])
eamodel.usshocks<-data.frame(model="Euro Area",shock="United States",variable=obsnames,data[["y.eamodel.usshocks"]][1:12,])
data<-rbind(usmodel.usshocks,usmodel.eashocks,eamodel.eashocks,eamodel.usshocks)
names(data)<-c("country_model","country_shock","variable",year)
counterfact<-melt(data,measure.var=year)
names(counterfact)[4]<-"time"
counterfact$time<-as.Date(counterfact$time)
levels(counterfact$variable)<-listObsRaw
#forecast
yearF<-as.character(seq(as.Date("2013/12/1"), as.Date("2023/12/1"), by = "3 months"))
forecastUS<-dataUS[["meanforecast"]]
meanforecastUS<-data.frame(int="mean",t(matrix(unlist(forecastUS[[2]][2:13]),nrow=41)))
infforecastUS<-data.frame(int="inf",matrix(unlist(forecastUS[[5]][2:13]),nrow=12,byrow=T))
supforecastUS<-data.frame(int="sup",matrix(unlist(forecastUS[[6]][2:13]),nrow=12,byrow=T))
forecastUS<-data.frame(country="United States",obs=obsnames,rbind(meanforecastUS,infforecastUS,supforecastUS))
forecastEA<-dataEA[["meanforecast"]]
meanforecastEA<-data.frame(int="mean",t(matrix(unlist(forecastEA[[2]][2:13]),nrow=41)))
infforecastEA<-data.frame(int="inf",matrix(unlist(forecastEA[[5]][2:13]),nrow=12,byrow=T))
supforecastEA<-data.frame(int="sup",matrix(unlist(forecastEA[[6]][2:13]),nrow=12,byrow=T))
forecastEA<-data.frame(country="Euro Area",obs=obsnames,rbind(meanforecastEA,infforecastEA,supforecastEA))
forecast <- rbind(forecastUS,forecastEA)
names(forecast)<-c("country","obs","int",yearF)
forecast<-melt(forecast,measure.var=yearF)
forecast$time<-as.Date(forecast$variable)
forecast$variable<-NULL
levels(forecast$obs)<-listObsRaw
forecast<-dcast(forecast,country + obs + time ~ int)
#posterior
dataPost<-data.frame(c(dimnames(dataEA$post.mode[[1]])[[1]],
dimnames(dataEA$post.mode[[2]])[[1]],
dimnames(dataEA$post.mode[[3]])[[1]]),
unlist(dataEA[["post.mode"]]),unlist(dataEA[["post.mean"]]),
unlist(dataEA[["post.hdpinf"]]),unlist(dataEA[["post.hdpsup"]]),unlist(dataEA[["post.std"]]),
unlist(dataUS[["post.mode"]]),unlist(dataUS[["post.mean"]]),
unlist(dataUS[["post.hdpinf"]]),unlist(dataUS[["post.hdpsup"]]),unlist(dataUS[["post.std"]]))
names(dataPost)<-c("names","Post. mode EA","Post. mean EA","Prob. Interval 10% EA","Prob. Interval 90% EA","Post. stdv EA","Post. mode US","Post. mean US","Prob. Interval 10% US","Prob. Interval 90% US","Post. stdv US")
dataPost$names<-gsub(".","_",dataPost$names,fixed=TRUE)
prior_shape<-readMat("C:/Users/brand/Dropbox/cepii_dsge/cmrfiles_deficit/cmrfiles_us/table4/baseline/cmr/prior/definition.mat")[[1]][[1]]
dataPrior<-data.frame(names=unlist(dataUS[["params.names"]]),
prior_shape,
prior_mean=unlist(dataUS[["prior.mean"]]),
prior_stdv=sqrt(diag(unlist(dataUS[["prior.var"]]))))
dataPrior$prior_shape<-factor(dataPrior$prior_shape)
levels(dataPrior$prior_shape)<-list("beta"=1,
"normal"=3,
"Weibull"=4,
"inverse gamma"=6)
names(dataPrior)<-c('names','Prior density','Prior mean','Prior stdv')
posterior<-merge(dataPrior,dataPost,by="names",sort=F)
levels(posterior$names)<-list("Monetary policy weight on output growth"="adytil_p",
"Monetary policy weight on inflation"="aptil_p",
"Consumption habits"="b_p",
"Std. dev., temporary technology shock"="e_epsil",
"Std. dev., government consumption shock"="e_g",
"Std. dev., equity shock"="e_gamma",
"Std. dev., price markup shock"="e_lambdaf",
"Std. dev., investment price shock"="e_muup",
"Std. dev., persistent technology shock"="e_muzstar",
"Std. dev., term structure shock"="e_term",
"Std. dev., monetary policy"="e_xp",
"Std. dev., consumption preferences"="e_zetac",
"Std. dev., investment efficiency"="e_zetai",
"Steady state probability of default"="Fomegabar_p",
"Price indexing weight on inflation target"="iota_p",
"Wage indexing weight on persistent technology growth"="iotamu_p",
"Wage indexing weight on inflation target"="iotaw_p",
"Monitoring cost"="mu_p",
"Std. dev., measurement error on networth"="networth_obs",
"Autocorrelation, temporary technology shock"="rhoepsil_p",
"Autocorrelation, government consumption shock"="rhog_p",
"Autocorrelation, price markup shock"="rholambdaf_p",
"Autocorrelation, investment price shock"="rhomuup_p",
"Autocorrelation, persistent technology growth shock"="rhomuzstar_p",
"Autocorrelation, risk shock"="rhosigma_p",
"Autocorrelation, term structure shock"="rhoterm_p",
"Autocorrelation, monetary policy shock"="rhotil_p",
"Autocorrelation, consumption preferences shock"="rhozetac_p",
"Autocorrelation, investment efficiency shock"="rhozetai_p",
"Curvature, investment adjust cost"="Sdoupr_p",
"Curvature, utilization cost"="sigmaa_p",
"Correlation among signals"="signal_corr_p",
"Std dev., anticipated risk shock"="stdsigma2_p",
"Std dev., unanticipated risk shock"="stdsigma1_p",
"Calvo price stickiness"="xip_p",
"Calvo wage stickiness"="xiw_p")
save(obsnames,dataSimLev,motiv1,motiv2,decompo,sum,vardecompo,birf,counterfact,forecast,posterior,file="C:/Users/brand/Dropbox/github/riskshocks/data.RData")
#Sys.setlocale("LC_TIME", "English_United States.1252")
#library(devtools)
#install_github('rstudio/shinyapps')
#library(shinyapps)
#deployApp()
library(shiny)
setwd("C:/Users/brand/Dropbox/github/riskshocks")
runApp(launch.browser=T)
setwd("C:/Users/brand/Dropbox/github/riskshocks")
runApp(launch.browser=T)
library(R.matlab)
library(reshape2)
library(plyr)
library(lubridate)
library(gdata)
setwd("C:/Users/Brand/Dropbox/cepii_dsge/output")
rm(list = ls())
year<-as.character(seq(as.Date("1988/3/1"), as.Date("2013/12/1"), by = "3 months"))
perl_path <- "C:/strawberry/perl/bin/perl.exe"
listObsLevel <- list("Real gdp per capita"="gdp",
"Real consumption per capita"="consumption",
"Real investment per capita"="investment",
"Real credit per capita" = "credit",
"Real networth per capita"="networth",
"Real price of investment"="pinvest",
"Real wage per capita"="wage",
"Gdp deflator"="deflator",
"Hours worked per capita"="hours")
listObsRaw<-list("Growth rate of gdp (year-on-year)"="gdp",
"Growth rate of consumption (year-on-year)"="consumption",
"Growth rate of investment (year-on-year)"="investment",
"Growth rate of credit (year-on-year)" = "credit",
"Growth rate of networth (year-on-year)"="networth",
"Growth rate of price of investment (year-on-year)"="pinvest",
"Wage inflation (year-on-year)"="wage",
"Hours worked (log)"="hours",
"Inflation (year-on-year)"="inflation",
"Short-term risk-free interest rate (APR)"="Re",
"Term premium (APP)"="Spread1",
"Credit spread (APP)"="premium")
listShock<-list("sum of shocks"="sumshocks",
"investment price"="e_muup",
"investment efficiency"="e_zetai",
"temporary technology"="e_epsil",
"persistent technology growth"="e_muzstar",
"price markup"="e_lambdaf",
"consumption preferences"="e_zetac",
"inflation target"="e_pitarget",
"term structure"="e_term",
"monetary policy"="e_xp",
"government consumption"="e_g",
"equity"="e_gamma",
"risk"="risk")
##motiv1 : rawdata in level (only 8 series)
rawLevelEA <- data.frame(read.xls("../cmrfiles_deficit/cmrfiles_ea/dataEA.xlsx",
sheet="datainlevel",perl=perl_path),
country="Euro Area")
rawLevelUS <- data.frame(read.xls("../cmrfiles_deficit/cmrfiles_us/dataUS.xlsx",
sheet="datainlevel",perl=perl_path),
country="United States")
rawLevel<-rbind(rawLevelEA,rawLevelUS)
rawLevel["time"]<-year
motiv1<-melt(rawLevel,id.vars=c("time","country"))
motiv1$time<-as.Date(as.character(motiv1$time))
levels(motiv1$variable)<-listObsLevel
##motiv2
#rawCMR : annualized CMR data (data_BAAoverTB.mat)
rawCMR<-readMat("rawdataCMR.mat")
yearCMR<-seq(as.Date("1981/12/1"), as.Date("2010/6/1"), by = "3 months")
rawCMR<-data.frame(rawCMR,time=yearCMR,country="United States (CMR data)",shock="rawdataCMR")
rawCMR<-melt(rawCMR,id.vars=c("time","country","shock"))
rawCMR$variable<-factor(gsub(".obs","",rawCMR$variable,fixed=TRUE))
rawCMR<-subset(rawCMR,year(time)>1987)
#raw4 used in estimation, annualized, with and without mean
raw4withmeanEA <- data.frame(read.xls("../cmrfiles_deficit/cmrfiles_ea/dataEA.xlsx",sheet="data4withmean",perl=perl_path),
country="Euro Area",shock="rawdata (with mean)")
raw4withoutmeanEA <- data.frame(read.xls("../cmrfiles_deficit/cmrfiles_ea/dataEA.xlsx",sheet="data4withoutmean",perl=perl_path),
country="Euro Area",shock="rawdata (without mean)")
raw4withmeanUS <- data.frame(read.xls("../cmrfiles_deficit/cmrfiles_us/dataUS.xlsx",sheet="data4withmean",perl=perl_path),
country="United States",shock="rawdata (with mean)")
raw4withoutmeanUS <- data.frame(read.xls("../cmrfiles_deficit/cmrfiles_us/dataUS.xlsx",sheet="data4withoutmean",perl=perl_path),
country="United States",shock="rawdata (without mean)")
raw4<-rbind(raw4withmeanEA,raw4withmeanUS,raw4withoutmeanEA,raw4withoutmeanUS)
raw4["time"]<-year
raw4<-melt(raw4,id.vars=c("time","country","shock"))
raw4$time<-as.Date(as.character(raw4$time))
raw4$variable<-factor(gsub("_obs","",raw4$variable,fixed=TRUE))
#motiv2 : merge rawCMR and raw4
motiv2<-rbind(raw4,rawCMR)
levels(motiv2$variable)<-listObsRaw
##result
#dataEA
dataEA<-readMat("C:/Users/brand/Dropbox/cepii_dsge/cmrfiles_deficit/cmrfiles_ea/table4/baseline/cmr_output.mat")
#obsnames contains 12 items (12observed variables)
obsnames<-gsub("_obs","",dataEA[["sim.endonames"]][1:12,],fixed=TRUE)
obsnames<-gsub(" ","",obsnames,fixed=TRUE)
#exonames contains 20 items (12shocks+8news)
exonames<-gsub( " ", "",dataEA[["sim.exonames"]],fixed=TRUE)
datEA<-data.frame()
for (i in 1:length(obsnames)){
datEA<-rbind(datEA,data.frame(variable=obsnames[i],
name=c(exonames,"initial","sumshocks"),
dataEA[["sim"]][i,,],
output='sim'
)
)
}
datLevEA<-data.frame()
for (i in 1:length(obsnames)){
datLevEA<-rbind(datLevEA,data.frame(variable=obsnames[i],
name=c(exonames,"initial","sumshocks"),
dataEA[["sim.lev"]][i,,],
output='simLev'
)
)
}
riskLevEA<-data.frame(variable=obsnames,name="risk",as.data.frame(dataEA[["sim.levrisk"]])[1:12,],output='simLev')
names(riskLevEA)<-names(datEA)
deflatorEA<-data.frame(variable="deflator",name=c(exonames,"initial","sumshocks"),as.data.frame(dataEA[["sim.price"]]),output='simLev')
names(deflatorEA)<-names(datEA)
dfEA<-rbind(datEA,datLevEA,riskLevEA,deflatorEA)
dfEA["country"]<-"Euro Area"
#dataUS
dataUS<-readMat("C:/Users/brand/Dropbox/cepii_dsge/cmrfiles_deficit/cmrfiles_us/table4/baseline/cmr_output.mat")
datUS<-data.frame()
for (i in 1:length(obsnames)){
datUS<-rbind(datUS,data.frame(variable=obsnames[i],
name=c(exonames,"initial","sumshocks"),
dataUS[["sim"]][i,,],
output='sim'
)
)
}
datLevUS<-data.frame()
for (i in 1:length(obsnames)){
datLevUS<-rbind(datLevUS,data.frame(variable=obsnames[i],
name=c(exonames,"initial","sumshocks"),
dataUS[["sim.lev"]][i,,],
output='simLev'
)
)
}
riskLevUS<-data.frame(variable=obsnames,name="risk",as.data.frame(dataUS[["sim.levrisk"]])[1:12,],output='simLev')
names(riskLevUS)<-names(datUS)
deflatorUS<-data.frame(variable="deflator",name=c(exonames,"initial","sumshocks"),as.data.frame(dataUS[["sim.price"]]),output='simLev')
names(deflatorUS)<-names(datUS)
dfUS<-rbind(datUS,datLevUS,riskLevUS,deflatorUS)
dfUS["country"]<-"United States"
data<-rbind(dfEA,dfUS)
names(data)<-c("variable","shock",year,"output","country")
meltdata<-melt(data,measure.var=year) #(14*2*102*23=60996)
names(meltdata)[5]<-"time"
shocknewsnames<-c("e_sigma","e_xi1","e_xi2","e_xi3","e_xi4","e_xi5","e_xi6","e_xi7","e_xi8")
subdata<-subset(meltdata,output=='sim' & shock %in% shocknewsnames)
risk_df<-data.frame(ddply(subdata,.(country,variable,time,output),summarise,value = sum(value)),shock="risk")
meltdata<-rbind(meltdata,risk_df)
data<-subset(meltdata,!(shock %in% cbind(shocknewsnames,"initial")))
truc<-t(as.data.frame(dataEA[["sim.pricerisk"]]))
subEA<-subset(meltdata,variable=="deflator" & shock=="e_sigma" & country=="Euro Area")
subEA['value']<-truc
subEA['shock']<-"risk"
truc<-t(as.data.frame(dataUS[["sim.pricerisk"]]))
subUS<-subset(meltdata,variable=="deflator" & shock=="e_sigma" & country=="United States")
subUS['value']<-truc
subUS['shock']<-'risk'
data<-rbind(data,subEA,subUS)
levels(data$shock)<-listShock
data$time<-as.Date(data$time)
data$country<-factor(data$country)
dataSimLev<-subset(data,output=='simLev')
levels(dataSimLev$variable)<-listObsLevel
dataSimLev$new <- paste(dataSimLev$shock,dataSimLev$country,sep=", ")
result<-dataSimLev[ order(dataSimLev[,1],dataSimLev[,4],dataSimLev[,2]),]
levels(data$variable)<-listObsRaw #careful : important order
decompo<-subset(data,output=='sim' & !(shock == "sum of shocks")) #(13*2*102*13=34476)
decompo$output<-NULL
sum<-subset(data,output=='sim' & shock == "sum of shocks") #(13*2*102)
sum$output<-NULL
#varDecompo
vardecompo<-rbind(data.frame(country="United States",c("sigma",obsnames),dataUS[["var.decompo"]]),
data.frame(country="Euro Area",c("sigma",obsnames),dataEA[["var.decompo"]]))
names(vardecompo) <- c("country","observ",exonames)
vardecompo<-subset(vardecompo,observ %in% obsnames)
vardecompo<-melt(vardecompo,id.vars=c("country","observ"))
subdata<-subset(vardecompo,variable %in% shocknewsnames)
risk_df<-data.frame(ddply(subdata,.(country,observ),summarise,value = sum(value)),variable="risk")
list_techno<-list("e-epsil","e_muzstar")
subdata<-subset(vardecompo,variable %in% list_techno)
techno_df<-data.frame(ddply(subdata,.(country,observ),summarise,value=sum(value)),variable="technology")
list_invest<-list("e_muup","e_zetai")
subdata<-subset(vardecompo,variable %in% list_invest)
invest_df<-data.frame(ddply(subdata,.(country,observ),summarise,value=sum(value)),variable="investment")
vardecompo<-subset(vardecompo,!(variable %in% list("e_sigma","e_xi1","e_xi2","e_xi3","e_xi4","e_xi5","e_xi6","e_xi7","e_xi8",
"e_epsil","e_muzstar",
"e_muup","e_zetai",
"e_pitarget","e_term")))
dataVardecompo<-rbind(risk_df,techno_df,invest_df,vardecompo)
dataVardecompo<-transform(dataVardecompo,value=round(value*100,0))
levels(dataVardecompo$observ)<-list("gdp"="gdp",
"consumption"="consumption",
"investment"="investment",
"credit"="credit",
"networth"="networth",
"credit spread"="Spread1",
"inflation"="inflation",
"hours worked"="hours",
"wage"="wage",
"interest rate"="Re",
"slope"="Spread1",
"invest. price"="pinvest")
dataVardecompo<-subset(dataVardecompo,!is.na(observ))
levels(dataVardecompo$variable)<-list("risk"="risk",
"equity"="e_gamma",
"investment"="investment",
"technology"="technology",
"markup"="e_lambdaf",
"cons. pref."="e_zetac",
"inflation target"="e_pitarget",
"term structure"="e_term",
"monetary"="e_xp",
"gov. exp."="e_g")
vardecompo<-dcast(dataVardecompo,country + observ ~ variable)
#birf
rownames<-c(row.names(as.data.frame(dataUS[["birf"]][2])))
name<-colsplit(rownames,"\\.",c("variable","obs","shock"))
name[2]<-NULL
meanbirfUS<-data.frame(int="mean",matrix(unlist(dataUS[["birf"]][2]),nrow = 260,byrow = T))
infbirfUS<-data.frame(int="inf",matrix(unlist(dataUS[["birf"]][5]),nrow = 260,byrow = T))
supbirfUS<-data.frame(int="sup",matrix(unlist(dataUS[["birf"]][6]),nrow = 260,byrow = T))
birfUS<-data.frame(country="United States",name,rbind(meanbirfUS,infbirfUS,supbirfUS))
meanbirfEA<-data.frame(int="mean",matrix(unlist(dataEA[["birf"]][2]),nrow = 260,byrow = T))
infbirfEA<-data.frame(int="inf",matrix(unlist(dataEA[["birf"]][5]),nrow = 260,byrow = T))
supbirfEA<-data.frame(int="sup",matrix(unlist(dataEA[["birf"]][6]),nrow = 260,byrow = T))
birfEA<-data.frame(country="Euro Area",name,rbind(meanbirfEA,infbirfEA,supbirfEA))
birf<-rbind(birfUS,birfEA)
birf<-subset(birf,!(variable=="sigma" | shock %in% list("e.xi1","e.xi2","e.xi3","e.xi4",
"e.xi5","e.xi6","e.xi7","e.xi8")
)
)
names(birf)<-c("country","variable","shock","int",1:40)
dataBirf<-melt(birf,id.vars=c("variable","shock","country","int"),variable.name="time")
dataBirf$variable<-factor(dataBirf$variable)
dataBirf$shock<-factor(dataBirf$shock)
levels(dataBirf$variable)<-listObsRaw
levels(dataBirf$shock)<-list("temporary technology"="e.epsil",
"government consumption"="e.g",
"equity"="e.gamma",
"price markup"="e.lambdaf",
"investment price"="e.muup",
"persistent technology growth"="e.muzstar",
"inflation target"="e.pitarget",
"consumption preferences"="e.zetac",
"investment efficiency"="e.zetai",
"risk"="e.sigma",
"term structure"="e.term",
"monetary policy"="e.xp")
birf<-dcast(dataBirf,variable + shock + country + time ~ int)
#counterfact
data<-readMat("C:/Users/brand/Dropbox/cepii_dsge/cmrfiles_deficit/counterfactual_analysis/cmr_output_counterfactual.mat")
usmodel.usshocks<-data.frame(model="United States",shock="United States",variable=obsnames,data[["y.usmodel.usshocks"]][1:12,])
usmodel.eashocks<-data.frame(model="United States",shock="Euro Area",variable=obsnames,data[["y.usmodel.eashocks"]][1:12,])
eamodel.eashocks<-data.frame(model="Euro Area",shock="Euro Area",variable=obsnames,data[["y.eamodel.eashocks"]][1:12,])
eamodel.usshocks<-data.frame(model="Euro Area",shock="United States",variable=obsnames,data[["y.eamodel.usshocks"]][1:12,])
data<-rbind(usmodel.usshocks,usmodel.eashocks,eamodel.eashocks,eamodel.usshocks)
names(data)<-c("country_model","country_shock","variable",year)
counterfact<-melt(data,measure.var=year)
names(counterfact)[4]<-"time"
counterfact$time<-as.Date(counterfact$time)
levels(counterfact$variable)<-listObsRaw
#forecast
yearF<-as.character(seq(as.Date("2013/12/1"), as.Date("2023/12/1"), by = "3 months"))
forecastUS<-dataUS[["meanforecast"]]
meanforecastUS<-data.frame(int="mean",t(matrix(unlist(forecastUS[[2]][2:13]),nrow=41)))
infforecastUS<-data.frame(int="inf",matrix(unlist(forecastUS[[5]][2:13]),nrow=12,byrow=T))
supforecastUS<-data.frame(int="sup",matrix(unlist(forecastUS[[6]][2:13]),nrow=12,byrow=T))
forecastUS<-data.frame(country="United States",obs=obsnames,rbind(meanforecastUS,infforecastUS,supforecastUS))
forecastEA<-dataEA[["meanforecast"]]
meanforecastEA<-data.frame(int="mean",t(matrix(unlist(forecastEA[[2]][2:13]),nrow=41)))
infforecastEA<-data.frame(int="inf",matrix(unlist(forecastEA[[5]][2:13]),nrow=12,byrow=T))
supforecastEA<-data.frame(int="sup",matrix(unlist(forecastEA[[6]][2:13]),nrow=12,byrow=T))
forecastEA<-data.frame(country="Euro Area",obs=obsnames,rbind(meanforecastEA,infforecastEA,supforecastEA))
forecast <- rbind(forecastUS,forecastEA)
names(forecast)<-c("country","obs","int",yearF)
forecast<-melt(forecast,measure.var=yearF)
forecast$time<-as.Date(forecast$variable)
forecast$variable<-NULL
levels(forecast$obs)<-listObsRaw
forecast<-dcast(forecast,country + obs + time ~ int)
#posterior
dataPost<-data.frame(c(dimnames(dataEA$post.mode[[1]])[[1]],
dimnames(dataEA$post.mode[[2]])[[1]],
dimnames(dataEA$post.mode[[3]])[[1]]),
unlist(dataEA[["post.mode"]]),unlist(dataEA[["post.mean"]]),
unlist(dataEA[["post.hdpinf"]]),unlist(dataEA[["post.hdpsup"]]),unlist(dataEA[["post.std"]]),
unlist(dataUS[["post.mode"]]),unlist(dataUS[["post.mean"]]),
unlist(dataUS[["post.hdpinf"]]),unlist(dataUS[["post.hdpsup"]]),unlist(dataUS[["post.std"]]))
names(dataPost)<-c("names","Post. mode EA","Post. mean EA","Prob. Interval 10% EA","Prob. Interval 90% EA","Post. stdv EA","Post. mode US","Post. mean US","Prob. Interval 10% US","Prob. Interval 90% US","Post. stdv US")
dataPost$names<-gsub(".","_",dataPost$names,fixed=TRUE)
prior_shape<-readMat("C:/Users/brand/Dropbox/cepii_dsge/cmrfiles_deficit/cmrfiles_us/table4/baseline/cmr/prior/definition.mat")[[1]][[1]]
dataPrior<-data.frame(names=unlist(dataUS[["params.names"]]),
prior_shape,
prior_mean=unlist(dataUS[["prior.mean"]]),
prior_stdv=sqrt(diag(unlist(dataUS[["prior.var"]]))))
dataPrior$prior_shape<-factor(dataPrior$prior_shape)
levels(dataPrior$prior_shape)<-list("beta"=1,
"normal"=3,
"Weibull"=4,
"inverse gamma"=6)
names(dataPrior)<-c('names','Prior density','Prior mean','Prior stdv')
posterior<-merge(dataPrior,dataPost,by="names",sort=F)
levels(posterior$names)<-list("Monetary policy weight on output growth"="adytil_p",
"Monetary policy weight on inflation"="aptil_p",
"Consumption habits"="b_p",
"Std. dev., temporary technology shock"="e_epsil",
"Std. dev., government consumption shock"="e_g",
"Std. dev., equity shock"="e_gamma",
"Std. dev., price markup shock"="e_lambdaf",
"Std. dev., investment price shock"="e_muup",
"Std. dev., persistent technology shock"="e_muzstar",
"Std. dev., term structure shock"="e_term",
"Std. dev., monetary policy"="e_xp",
"Std. dev., consumption preferences"="e_zetac",
"Std. dev., investment efficiency"="e_zetai",
"Steady state probability of default"="Fomegabar_p",
"Price indexing weight on inflation target"="iota_p",
"Wage indexing weight on persistent technology growth"="iotamu_p",
"Wage indexing weight on inflation target"="iotaw_p",
"Monitoring cost"="mu_p",
"Std. dev., measurement error on networth"="networth_obs",
"Autocorrelation, temporary technology shock"="rhoepsil_p",
"Autocorrelation, government consumption shock"="rhog_p",
"Autocorrelation, price markup shock"="rholambdaf_p",
"Autocorrelation, investment price shock"="rhomuup_p",
"Autocorrelation, persistent technology growth shock"="rhomuzstar_p",
"Autocorrelation, risk shock"="rhosigma_p",
"Autocorrelation, term structure shock"="rhoterm_p",
"Autocorrelation, monetary policy shock"="rhotil_p",
"Autocorrelation, consumption preferences shock"="rhozetac_p",
"Autocorrelation, investment efficiency shock"="rhozetai_p",
"Curvature, investment adjust cost"="Sdoupr_p",
"Curvature, utilization cost"="sigmaa_p",
"Correlation among signals"="signal_corr_p",
"Std dev., anticipated risk shock"="stdsigma2_p",
"Std dev., unanticipated risk shock"="stdsigma1_p",
"Calvo price stickiness"="xip_p",
"Calvo wage stickiness"="xiw_p")
save(obsnames,motiv1,motiv2,result,decompo,sum,vardecompo,birf,counterfact,forecast,posterior,file="C:/Users/brand/Dropbox/github/riskshocks/data.RData")
#Sys.setlocale("LC_TIME", "English_United States.1252")
#library(devtools)
#install_github('rstudio/shinyapps')
#library(shinyapps)
#deployApp()
library(shiny)
setwd("C:/Users/brand/Dropbox/github/riskshocks")
runApp(launch.browser=T)
library(shiny)
runApp(launch.browser = T)
library(shiny)
runApp(launch.browser = T)
